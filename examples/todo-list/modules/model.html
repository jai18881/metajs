<html>

	<script type="text/javascript">

		window.TodoModel = function(){

			//Define save function
			var save = function(){

				localStorage.setItem("com.example.todoList", JSON.stringify(model.data));

			}

			//Define model interface

			var model = {

				data: [ { name: "Default list", items: [] } ],
				activeList: null,

				addList: function(name){
					model.data.push( { name: name, items: [] } );
					save();
				},

				removeList: function(list){
					model.data.splice(list, 1);
					save();
				},

				addTodo: function(list, item){

					if(!model.data[list])
						throw "Undefined list";

					model.data[list].items.unshift({
						task: item,
						completed: false
					});

					save();

				},

				markTodo: function(list, index){

					if(!model.data[list] || !model.data[list].items[index])
						throw "Undefined item";

					model.data[list].items[index].completed = !model.data[list].items[index].completed;

					save();

				},

				removeTodo: function(list, index){

					if(!model.data[list] || !model.data[list].items[index])
						throw "Undefined item";

					model.data[list].items.splice(index, 1);

					save();
					
				}

			}

			//Load stored data
			var storedData = localStorage.getItem("com.example.todoList");

			if(storedData)
				model.data = JSON.parse(storedData);

			return model;

		}

	</script>

</html>