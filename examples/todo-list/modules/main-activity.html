<html>

	<template is="meta-view" name="com.example.todo.MainActivity">

		<style>



		</style>

		<div id="wrap">
			<meta-activity name="com.example.todo.ListActivity" id="lists"></meta-activity>
			<meta-activity name="com.example.todo.TodoActivity" id="todo"></meta-activity>
		</div>

	</template>

	<script type="text/javascript">

		Meta.Activity('com.example.todo.MainActivity', {

			import: [ "provider", "list-activity", "todo-activity" ],

			view: 'com.example.todo.MainActivity',

			onCreate: function(self){

				self.provider = new TodoProvider();
				self.activeList = null;

				self.provider.on("changed", function(lists){

					self.view.$["lists"].setLists(lists);

					if(!self.activeList && lists.length > 0)
						self._setActiveList(lists[0]);

					if(lists.indexOf(self.activeList) >= 0)
						self._setActiveList(self.activeList)
					else
						self._setActiveList(null);

				});

			},

			onReady: function(self){

				self.provider.load();

			},

			_setActiveList: function(todoList){

				this.activeList = todoList;
				this.view.$["lists"].setActiveList(this.activeList);
				this.view.$["todo"].setList(this.activeList);

			},

			events: {

				"selectList #lists": function(ev){
					this.fragment._setActiveList(ev.todoList);
				},

				"addList #lists": function(ev){
					this.fragment.provider.addList(ev.listName);
				},

				"removeList #lists": function(ev){
					this.fragment.provider.removeList(ev.todoList);
				}

			}

		});

	</script>

</html>