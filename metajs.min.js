/*
 * MetaJS - MetaPlatform project
 *
 * @author Jiri Hybek <jiri.hybek@cryonix.cz> / Cryonix Innovations <www.cryonix.cz>
 * @license MIT
 * 
 * More at http://www.meta-platform.com
 */
window.Meta||(window.Meta={}),window.Meta.Utils={},window.Meta.views={},window.Meta.fragments={},window.Meta.activities={},window.Meta.config||(window.Meta.config={}),window.Meta.Utils._importedModules=[],window.Meta.Utils["import"]=function(t,e,i){if(window.Meta.Utils._importedModules[t])return e();var o=document.createElement("link");o.rel="import",o.href=(window.Meta.config.importPrefix||"")+t+".html",o.onload=function(){window.Meta.Utils._importedModules.push(t),e&&e()},o.onerror=function(e){console.log("Error importing meta module '"+t+"'",e),i&&i(e)},document.head.appendChild(o)},window.Meta.Utils.importMany=function(t,e,i){var o=function(t,e){window.Meta.Utils["import"](t,function(){return e()},function(){return e("Cannot import module '"+t+"'")})};window.Meta.Utils.batch(t,o,function(t){return t?i(t):e()})},window.Meta.Utils.batch=function(t,e,i){var o=-1,n=function(r){return o++,r?i(r):o==t.length?i():void e(t[o],n)};n()},window.Meta.Utils.idHashmap=function(t){for(var e={},i=t.querySelectorAll("*[id]"),o=0;o<i.length;o++)e[i.item(o).getAttribute("id")]=i.item(o);return e},window.Meta.ViewPrototype=Object.create(HTMLTemplateElement.prototype),window.Meta.ViewPrototype.createdCallback=function(){this.hasAttribute("name")&&(window.Meta.views[this.getAttribute("name")]=this)},window.Meta.ViewPrototype.template=function(){if(!this._template){var t=document.createElement("div");t.appendChild(document.importNode(this.content,!0)),this._template=Handlebars.compile(t.innerHTML,{strict:!0}),delete t}return this._template.apply(this,arguments)},window.Meta.ViewPrototype.instance=function(t){var e=this,i=[],o={target:t,model:{},on:function(t,e,o,n){i.push({name:t,selector:e,handler:o,context:n})},render:function(){function t(t,e){t.addEventListener(e.name,function(i){i.sender=t,e.handler.call(e.context||o,i)})}o.target.innerHTML=e.template(o.model);for(var n in i)for(var r=o.target.querySelectorAll(i[n].selector),a=0;a<r.length;a++)t(r.item(a),i[n]);o.$=window.Meta.Utils.idHashmap(o.target)},getElementById:function(t){return o.target.getElementById(t)},querySelector:function(t){return o.target.querySelector(t)},querySelectorAll:function(t){return o.target.querySelectorAll(t)},observe:function(){Object.observe(o.model,function(){o.render()})}};return o},document.registerElement("meta-view",{prototype:window.Meta.ViewPrototype,"extends":"template"}),Handlebars.registerHelper("literal",function(t){return t.fn()}),window.Meta.Fragment=function(t,e){void 0==e.shadowRoot&&(e.shadowRoot=!0),void 0==e.observeModel&&(e.observeModel=!0),window.Meta.fragments[t]=e},window.Meta.FragmentPrototype=Object.create(HTMLElement.prototype),window.Meta.FragmentPrototype._getConfig=function(t){if(!window.Meta.fragments[t])throw"Fragment '"+t+"' not registered.";this.config=window.Meta.fragments[t]},window.Meta.FragmentPrototype._create=function(){this.model={},this.config.view&&this.setView(this.config.view),this.config.onCreate&&this.config.onCreate.call(this,this),this.fireEvent("create"),this.config.observeModel&&this.observe(this.model),this.view.render()},window.Meta.FragmentPrototype.setView=function(t){if("string"==typeof t){if(!window.Meta.views[t])throw"Meta view '"+t+"' not registered.";this.view=window.Meta.views[t].instance()}else this.view=t.instance();this.view.model=this.model,this.view.target=this.config.shadowRoot?this.shadow:this},window.Meta.FragmentPrototype.observe=function(t){var e=this;Object.observe(t,function(){e.view.render()})},window.Meta.FragmentPrototype.createdCallback=function(){var t=this;this.name=this.getAttribute("name"),this._getConfig(this.name),this.config.shadowRoot&&(this.shadow=this.createShadowRoot()),this.config["import"]?window.Meta.Utils.importMany(this.config["import"],function(){t._create()},function(){throw"Import for fragment '"+this.name+"' failed"}):t._create()},window.Meta.FragmentPrototype.fireEvent=function(t,e){var i=new CustomEvent(t,e);i.fragment=this,this.dispatchEvent(i)},document.registerElement("meta-fragment",{prototype:window.Meta.FragmentPrototype}),window.Meta.Activity=function(t,e){void 0==e.shadowRoot&&(e.shadowRoot=!0),void 0==e.observeModel&&(e.observeModel=!0),window.Meta.activities[t]=e},window.Meta.ActivityPrototype=Object.create(window.Meta.FragmentPrototype),window.Meta.ActivityPrototype._getConfig=function(t){if(!window.Meta.activities[t])throw"Activity '"+t+"' not registered.";this.config=window.Meta.activities[t]},document.registerElement("meta-activity",{prototype:window.Meta.ActivityPrototype});