/*
 * MetaJS - MetaPlatform project
 *
 * @author Jiri Hybek <jiri.hybek@cryonix.cz> / Cryonix Innovations <www.cryonix.cz>
 * @license MIT
 */
window.Meta||(window.Meta={}),window.Meta.Utils={},window.Meta.config||(window.Meta.config={}),window.Meta.config.importUrl||(window.Meta.config.importUrl="modules/%module%.html"),window.Meta.Utils._importedModules=[],window.Meta.Utils["import"]=function(e,t,n){if(window.Meta.Utils._importedModules.indexOf(e)>=0)return t();var i=document.createElement("link");i.rel="import",i.href=window.Meta.config.importUrl.replace(/\%module\%/g,e),i.onload=function(){window.Meta.Utils._importedModules.push(e),t&&t()},i.onerror=function(t){console.log("Error importing meta module '"+e+"'",t),n&&n(t)},document.head.appendChild(i)},window.Meta.Utils.importMany=function(e,t,n){var i=function(e,t){window.Meta.Utils["import"](e,function(){return t()},function(){return t("Cannot import module '"+e+"'")})};window.Meta.Utils.batch(e,i,function(e){return e?n(e):t()})},window.Meta.Utils.batch=function(e,t,n){var i=-1,a=function(r){return i++,r?n(r):i==e.length?n():void t(e[i],a)};a()},window.Meta.Utils.idHashmap=function(e){for(var t={},n=e.querySelectorAll("*[id]"),i=0;i<n.length;i++)t[n.item(i).getAttribute("id")]=n.item(i);return t},window.Meta.Utils.sanitizeHtml=function(e){var t=new RegExp("<","g"),n=new RegExp("<","g");return String(e).replace(t,"&lt;").replace(n,"&gt;")},window.Meta.Utils.traverse=function(e,t){var n=t.shift();return e[n]?t.length>0?window.Meta.Utils.traverse(e[n],t):e[n]:void 0},window.Meta.Utils.formatDate=function(e,t){var n,i,a=this,r=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],o=/\\?(.?)/gi,s=function(e,t){return i[e]?i[e]():t},l=function(e,t){for(e=String(e);e.length<t;)e="0"+e;return e};return i={d:function(){return l(i.j(),2)},D:function(){return i.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return r[i.w()]+"day"},N:function(){return i.w()||7},S:function(){var e=i.j(),t=e%10;return 3>=t&&1==parseInt(e%100/10,10)&&(t=0),["st","nd","rd"][t-1]||"th"},w:function(){return n.getDay()},z:function(){var e=new Date(i.Y(),i.n()-1,i.j()),t=new Date(i.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(i.Y(),i.n()-1,i.j()-i.N()+3),t=new Date(e.getFullYear(),0,4);return l(1+Math.round((e-t)/864e5/7),2)},F:function(){return r[6+i.n()]},m:function(){return l(i.n(),2)},M:function(){return i.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(i.Y(),i.n(),0).getDate()},L:function(){var e=i.Y();return e%4===0&e%100!==0|e%400===0},o:function(){var e=i.n(),t=i.W(),n=i.Y();return n+(12===e&&9>t?1:1===e&&t>9?-1:0)},Y:function(){return n.getFullYear()},y:function(){return i.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return i.a().toUpperCase()},B:function(){var e=3600*n.getUTCHours(),t=60*n.getUTCMinutes(),i=n.getUTCSeconds();return l(Math.floor((e+t+i+3600)/86.4)%1e3,3)},g:function(){return i.G()%12||12},G:function(){return n.getHours()},h:function(){return l(i.g(),2)},H:function(){return l(i.G(),2)},i:function(){return l(n.getMinutes(),2)},s:function(){return l(n.getSeconds(),2)},u:function(){return l(1e3*n.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var e=new Date(i.Y(),0),t=Date.UTC(i.Y(),0),n=new Date(i.Y(),6),a=Date.UTC(i.Y(),6);return e-t!==n-a?1:0},O:function(){var e=n.getTimezoneOffset(),t=Math.abs(e);return(e>0?"-":"+")+l(100*Math.floor(t/60)+t%60,4)},P:function(){var e=i.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-n.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(o,s)},r:function(){return"D, d M Y H:i:s O".replace(o,s)},U:function(){return n/1e3|0}},this.date=function(e,t){return a=this,n=void 0===t?new Date:new Date(t instanceof Date?t:1e3*t),e.replace(o,s)},this.date(e,t)},window.Meta||(window.Meta={}),window.Meta.Template=function(e,t){var n=window.Meta.Template.processor(t);return function(t){n.call(e,{data:t})}},window.Meta.Template._context=function(e,t){var n={};for(var i in t)n[i]=t[i];return n.data=e.data,n},window.Meta.Template._value=function(e,t,n){if(n instanceof Function)return n.call(e,t.data,t);if("@"==n.substr(0,1)){var i=t;n=n.substr(1)}else var i=t.data;return n.indexOf(".")>=0?window.Meta.Utils.traverse(i,n.split(".")):i[n]},window.Meta.Template.processor=function(e){for(selector in e||{})if(e[selector]instanceof Array)for(var t=0;t<e[selector].length;t++)e[selector][t]instanceof Function||(e[selector][t]=window.Meta.Template.text(e[selector][t]));else e[selector]instanceof Function||(e[selector]=window.Meta.Template.text(e[selector]));var n=function(e,t,n){if(n instanceof Array)for(var i=0;i<n.length;i++)n[i].call(e,t);else n.call(e,t)};return function(t){for(selector in e||{})if(e[selector]instanceof Function&&e[selector].runInParentContext)e[selector].call(this,window.Meta.Template._context(t,{selector:selector}));else if("@"!=selector)for(var i=this.querySelectorAll(selector),a=0;a<i.length;a++)n(i.item(a),t,e[selector]);else n(this,t,e[selector])}},window.Meta.Template.filters={},window.Meta.Template.registerFilter=function(e,t){window.Meta.Template.filters[e]=t},window.Meta.Template.html=function(e){return function(t){this.innerHTML=window.Meta.Template._value(this,t,e)||""}},window.Meta.Template.text=function(e){return function(t){this.innerHTML=window.Meta.Utils.sanitizeHtml(window.Meta.Template._value(this,t,e))}},window.Meta.Template.string=function(e){for(var t=e.match(/#\{([a-zA-Z0-9_-]*)\}/g),n={},i=0;i<t.length;i++){var a=t[i].substr(2,t[i].length-3);n[a]=new RegExp("#\\{"+a+"\\}","g")}return function(t){var i=e;for(var a in n)i=i.replace(n[a],window.Meta.Template._value(this,t,a));this.innerHTML=i}},window.Meta.Template.fn=function(e){return function(t){this.innerHTML=e.call(this,t.data,t)}},window.Meta.Template.filter=function(e,t,n){return function(i){if(!window.Meta.Template.filters[e])throw"Template filter '"+e+"' not registered.";this.innerHTML=window.Meta.Template.filters[e].call(this,window.Meta.Template._value(this,i,t),n,i)}},window.Meta.Template.date=function(e,t){return function(n){var i=window.Meta.Template._value(this,n,e);return 0/0!==parseInt(i)&&i instanceof Date?void(this.innerHTML=window.Meta.Utils.formatDate(t,i)):this.innerHTML="NaN"}},window.Meta.Template["with"]=function(e,t){var n=window.Meta.Template.processor(t);return function(t){t.data[e]&&n.call(this,window.Meta.Template._context({data:t.data[e]},{parent:t.data}))}},window.Meta.Template.attr=function(e,t){return function(n){if("undefined"!=typeof ShadowRoot&&this instanceof ShadowRoot)var i=this.host;else var i=this;i.setAttribute(e,window.Meta.Template._value(this,n,t))}},window.Meta.Template.attrIf=function(e,t,n){return function(i){var a=window.Meta.Template._value(this,i,t);if("undefined"!=typeof ShadowRoot&&this instanceof ShadowRoot)var r=this.host;else var r=this;a?r.setAttribute(e,n?"":a):r.hasAttribute(e)&&r.removeAttribute(e)}},window.Meta.Template.classIf=function(e,t){return function(n){var i=window.Meta.Template._value(this,n,t);if("undefined"!=typeof ShadowRoot&&this instanceof ShadowRoot)var a=this.host;else var a=this;i?a.classList.add(e):a.classList.contains(e)&&a.classList.remove(e)}},window.Meta.Template.property=function(e,t){return function(n){if("undefined"!=typeof ShadowRoot&&this instanceof ShadowRoot)var i=this.host;else var i=this;i[e]=t?window.Meta.Template._value(this,n,t):n.data}},window.Meta.Template._if=function(e,t){var n=window.Meta.Template.processor(e),i=function(e){var i=t.call(this,e);if(i){if(this.__ifRegistry&&this.__ifRegistry[e.selector]){for(var a=this.__ifRegistry[e.selector],r=0;r<a.length;r++)a[r].__nextSibling&&a[r].__nextSibling.parentElement==a[r].__parent?a[r].__parent.insertBefore(a[r],a[r].__nextSibling):a[r].__parent.appendChild(a[r]);delete this.__ifRegistry[e.selector]}for(var o=this.querySelectorAll(e.selector),r=0;r<o.length;r++)n.call(o.item(r),e)}else{var o=this.querySelectorAll(e.selector);this.__ifRegistry||(this.__ifRegistry={}),this.__ifRegistry[e.selector]||(this.__ifRegistry[e.selector]=[]);for(var r=0;r<o.length;r++)o.item(r).__parent=o.item(r).parentElement,o.item(r).__nextSibling=o.item(r).nextSibling,this.__ifRegistry[e.selector].push(o.item(r)),o.item(r).parentElement.removeChild(o.item(r))}};return i.runInParentContext=!0,i},window.Meta.Template["if"]=function(e,t){return window.Meta.Template._if(t,function(t){return window.Meta.Template._value(this,t,e)?!0:!1})},window.Meta.Template.ifNot=function(e,t){return window.Meta.Template._if(t,function(t){return window.Meta.Template._value(this,t,e)?!1:!0})},window.Meta.Template.ifLt=function(e,t,n){return window.Meta.Template._if(n,function(n){var i=t instanceof Function?t.call(this,n.data,n):t;return window.Meta.Template._value(this,n,e)<i?!0:!1})},window.Meta.Template.ifLte=function(e,t,n){return window.Meta.Template._if(n,function(n){var i=t instanceof Function?t.call(this,n.data,n):t;return window.Meta.Template._value(this,n,e)<=i?!0:!1})},window.Meta.Template.ifGt=function(e,t,n){return window.Meta.Template._if(n,function(n){var i=t instanceof Function?t.call(this,n.data,n):t;return window.Meta.Template._value(this,n,e)>i?!0:!1})},window.Meta.Template.ifGte=function(e,t,n){return window.Meta.Template._if(n,function(n){var i=t instanceof Function?t.call(this,n.data,n):t;return window.Meta.Template._value(this,n,e)>=i?!0:!1})},window.Meta.Template.repeat=function(e,t){var n=window.Meta.Template.processor(t),i=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)t[n]=e[n];else{if(!(e instanceof Object))return null;var i=0;for(var n in e||{})t[i]=n,i++}return t},a=function(t){if(this.__repeatTemplate||(this.__repeatTemplate={}),!this.__repeatTemplate[t.selector]){this.__repeatTemplate[t.selector]=[];for(var a=this.querySelectorAll(t.selector),r=0;r<a.length;r++)a.item(r).__parent=a.item(r).parentElement,this.__repeatTemplate[t.selector].push(a.item(r)),a.item(r).parentElement.removeChild(a.item(r))}var o=this,s=[],l={},d=null,w=window.Meta.Template._value(this,t,e),c=i(w);if(c){for(var a=this.querySelectorAll(t.selector),r=0;r<a.length;r++){var f=c.indexOf(a.item(r).__id);f>=0?(l[f]||(l[f]=[]),l[f].push(a.item(r))):s.push(a.item(r))}for(var u=0;u<s.length;u++)s[u].parentElement.removeChild(s[u]);delete s;for(var r=0;r<c.length;r++){if(c[r]instanceof Object)var h=c[r];else var h=w[c[r]];if(l[r])for(var m=0;m<l[r].length;m++)l[r][m]instanceof HTMLElement&&n.call(l[r][m],window.Meta.Template._context({data:h},{parent:t.data,index:r,key:c[r]})),l[r][m].previousElementSibling!=d&&l[r][m].parentElement.appendChild(l[r][m]),d=l[r][m];else for(var p=0;p<o.__repeatTemplate[t.selector].length;p++){var v=o.__repeatTemplate[t.selector][p].cloneNode(!0);v.__id=c[r],o.__repeatTemplate[t.selector][p].__parent.appendChild(v),n.call(v,window.Meta.Template._context({data:h},{parent:t.data,index:r,key:c[r]})),d=v}}}};return a.runInParentContext=!0,a},window.$__html=window.Meta.Template.html,window.$__text=window.Meta.Template.text,window.$__string=window.Meta.Template.string,window.$__fn=window.Meta.Template.fn,window.$__filter=window.Meta.Template.filter,window.$__date=window.Meta.Template.date,window.$__attr=window.Meta.Template.attr,window.$__attrIf=window.Meta.Template.attrIf,window.$__classIf=window.Meta.Template.classIf,window.$__prop=window.Meta.Template.property,window.$__if=window.Meta.Template["if"],window.$__ifNot=window.Meta.Template.ifNot,window.$__ifLt=window.Meta.Template.ifLt,window.$__ifLte=window.Meta.Template.ifLte,window.$__ifGt=window.Meta.Template.ifGt,window.$__ifGte=window.Meta.Template.ifGte,window.$__repeat=window.Meta.Template.repeat,window.$__with=window.Meta.Template["with"],Meta.Template.registerFilter("uppercase",function(e){return e.toUpperCase()}),Meta.Template.registerFilter("lowercase",function(e){return e.toLowerCase()}),Meta.Template.registerFilter("trim",function(e){return e.trim()}),Meta.Template.registerFilter("substr",function(e,t){return e.substr(t.offset,t.length)}),Meta.Template.registerFilter("replace",function(e,t){if(!t.find||!t.replace)return"NaN";if(t.find instanceof RegExp)return e.replace(t.find,t.replace);if(t.global){var n=new RegExp(t.find,"g");return e.replace(n,t.replace)}return e.replace(t.find,t.replace)}),window.Meta||(window.Meta={}),window.Meta.views={},window.Meta.ViewPrototype=Object.create(HTMLTemplateElement.prototype),window.Meta.ViewPrototype.createdCallback=function(){this.hasAttribute("name")&&(window.Meta.views[this.getAttribute("name")]=this)},window.Meta.ViewPrototype.instance=function(e,t){var n=this,i={target:null,template:null,model:{},events:{},eventsContext:null,materialize:function(e,t){i.target=e,i.target._templateInstanced||(i.target.innerHTML="",i.target.appendChild(document.importNode(n.content,!0)),i.target._templateInstanced=!0),i.template=window.Meta.Template(e,t),i.$=window.Meta.Utils.idHashmap(i.target)},on:function(e,t,n){i.events[e+" "+t]=n},_bindEvents:function(){var e=function(e,t,n){if(!(e._boundEvents&&e._boundEvents.indexOf(t)>=0)){var a=function(t){t.sender=e,n.call(i.eventsContext||this,t)};a.eventName=t,e.addEventListener(t,a),e._boundEvents||(e._boundEvents=[]),e._boundEventHandlers||(e._boundEventHandlers=[]),e._boundEvents.push(t),e._boundEventHandlers.push(a)}};for(var t in i.events){var n=t.split(" "),a=n.shift(),r=n.join(" ");if(""!=r)var o=i.target.querySelectorAll(r);else if(i.target instanceof ShadowRoot)var o=[i.target.host];else var o=[i.target];for(var s=0;s<o.length;s++)e(o[s],a,i.events[t])}},_unbindEvents:function(){for(var e in i.events){var t=e.split(" "),n=(t.shift(),t.join(" "));if(""!=n)var a=i.target.querySelectorAll(n);else if(i.target instanceof ShadowRoot)var a=[i.target.host];else var a=[i.target];for(var r=0;r<a.length;r++)if(a[r]._boundEventHandlers){for(var e=0;e<a[r]._boundEventHandlers.length;e++)a[r].removeEventListener(a[r]._boundEventHandlers[e].eventName,a[r]._boundEventHandlers[e]);a[r]._boundEvents=[],a[r]._boundEventHandlers=[]}}},render:function(){if(!i.template)throw"Template is not materialized.";i.template(i.model),i._bindEvents(),i.$=window.Meta.Utils.idHashmap(i.target)},find:function(e){return i.target.querySelector(e)},findAll:function(e){return i.target.querySelectorAll(e)}};return i.eventsContext=i,e&&t&&i.materialize(e,t),i},document.registerElement("meta-view",{prototype:window.Meta.ViewPrototype,"extends":"template"}),window.Meta||(window.Meta={}),window.Meta.fragments={},window.Meta.Fragment=function(e,t){if(void 0==t.shadowRoot&&(t.shadowRoot=!0),t["extends"]){t["extends"]instanceof Array||(t["extends"]=[t["extends"]]);for(var n=0;n<t["extends"].length;n++){if(!window.Meta.fragments[t["extends"][n]])throw"Cannot register fragment '"+e+"': parent fragment '"+t["extends"][n]+"' not found.";for(var i in window.Meta.fragments[t["extends"][n]])t[i]=window.Meta.fragments[t["extends"][n]][i]}}window.Meta.fragments[e]=t},window.Meta.FragmentPrototype=Object.create(HTMLElement.prototype),window.Meta.FragmentPrototype._defaultMethods=["onCreate","onReady","onResume","onPause","onRender"],window.Meta.FragmentPrototype._getConfig=function(e){return window.Meta.fragments[e]||null},window.Meta.FragmentPrototype.init=function(){if(this.name)throw"Fragment '"+name+"' already initialized.";if(this.name=this.getAttribute("name"),this._created=!1,this._ready=!1,this._auto=this.hasAttribute("auto")?!0:!1,this._paused=!0,this._resumeStack=[],this._readyStack=[],this.config=this._getConfig(this.name),!this.config)throw"Fragment '"+this.name+"' not registered.";for(k in this.config)this.config[k]instanceof Function&&window.Meta.FragmentPrototype._defaultMethods.indexOf(k)<0&&this.bindMethod(this,k,this.config[k]);this.fragmentRoot=this.config.shadowRoot?this.createShadowRoot():this,this.style.visibility="hidden";var e=this;this.config["import"]?window.Meta.Utils.importMany(this.config["import"],function(){e.create()},function(){throw"Imports for fragment '"+e.name+"' failed"}):e.create()},window.Meta.FragmentPrototype.create=function(){if(this._created)throw"Fragment '"+this.name+"' already created.";var e=this;this.model=this.config.model?Object.create(this.config.model):{},this.config.onCreate&&this.config.onCreate.call(this,this),this._created=!0,this.fireEvent("create"),this.setView(this.config.view);var t=function(e,t){e.whenReady(t)},n=this.fragmentRoot.querySelectorAll("meta-fragment, meta-activity");window.Meta.Utils.batch(n,t,function(){e._ready=!0,e.config.onReady&&e.config.onReady.call(e,e);for(var t in e._readyStack)e._readyStack[t]&&e._readyStack[t].call(e);e._readyStack=[],(e.parentElement&&e._auto||e._resumeStack.length>0)&&e.resume()})},window.Meta.FragmentPrototype.resume=function(e){if(!this._paused)return this.render(),e?e():void 0;if(this._resumeStack.push(e),this._ready){var t=this;this.render();var n=function(e,t){e.resume(t)},i=this.fragmentRoot.querySelectorAll("meta-fragment, meta-activity");window.Meta.Utils.batch(i,n,function(){t._paused=!1,t.config.onResume&&t.config.onResume.call(t,t);for(var e in t._resumeStack)t._resumeStack[e]&&t._resumeStack[e].call(t);t._resumeStack=[],t.style.visibility="visible"})}},window.Meta.FragmentPrototype.pause=function(e){if(!this._created||this._paused)return e?e():void 0;this.view&&this.view._unbindEvents();var t=this,n=function(e,t){e.pause(t)},i=this.fragmentRoot.querySelectorAll("meta-fragment, meta-activity");window.Meta.Utils.batch(i,n,function(){t._paused=!0,t.config.onPause&&t.config.onPause.call(t,t),e&&e()})},window.Meta.FragmentPrototype.whenReady=function(e){return this._ready?e():void this._readyStack.push(e)},window.Meta.FragmentPrototype.bindMethod=function(e,t,n){e[k]=function(){if(!e._created||e._paused)throw"Fragment '"+this.name+"' is not ready yet.";n.apply(e,arguments)}},window.Meta.FragmentPrototype.setView=function(e){if("string"==typeof e){if(!window.Meta.views[e])throw"Meta view '"+e+"' not registered.";this.view=window.Meta.views[e].instance()}else this.view=e.instance();this.view.materialize(this.fragmentRoot,this.config.binding||{}),this.view.model=this.model,this.view.events=this.config.events||{},this.view.eventsContext=this,this.view.fragment=this,this.$=this.view.$},window.Meta.FragmentPrototype.render=function(){this.view&&(this.view.render(),this.$=this.view.$),this.config.onRender&&this.config.onRender.call(this,this)},window.Meta.FragmentPrototype.createdCallback=function(){this.hasAttribute("name")&&this.init()},window.Meta.FragmentPrototype.attachedCallback=function(){this._created&&this._auto&&this.resume()},window.Meta.FragmentPrototype.dettachedCallback=function(){this._created&&this._auto&&this.pause()},window.Meta.FragmentPrototype.attributeChangedCallback=function(e){"name"==e?this.init():this.fireEvent(e+"Changed",{fragment:this})},window.Meta.FragmentPrototype.fireEvent=function(e,t){var n=new CustomEvent(e);n.fragment=this;for(var i in t)n[i]=t[i];this.dispatchEvent(n)},document.registerElement("meta-fragment",{prototype:window.Meta.FragmentPrototype}),window.Meta||(window.Meta={}),window.Meta.activities={},window.Meta.Activity=function(e,t){if(void 0==t.shadowRoot&&(t.shadowRoot=!0),t["extends"]){t["extends"]instanceof Array||(t["extends"]=[t["extends"]]);for(var n=0;n<t["extends"].length;n++){if(!window.Meta.activities[t["extends"][n]])throw"Cannot register fragment '"+e+"': parent fragment '"+t["extends"][n]+"' not found.";for(var i in window.Meta.activities[t["extends"][n]])t[i]=window.Meta.activities[t["extends"][n]][i]}}window.Meta.activities[e]=t},window.Meta.CreateActivity=function(e,t,n){if(!window.Meta.activities[t])throw"Activity '"+t+"' not registered.";var i=document.createElement("meta-activity");return i.setAttribute("name",t),e.appendChild(i),n&&i.resume(),i},window.Meta.ActivityPrototype=Object.create(window.Meta.FragmentPrototype),window.Meta.ActivityPrototype._getConfig=function(e){return window.Meta.activities[e]||null},document.registerElement("meta-activity",{prototype:window.Meta.ActivityPrototype}),window.Meta||(window.Meta={}),window.Meta.EventsPrototype={eventListeners:{},on:function(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},off:function(e,t){if(this.eventListeners[e]){var n=this.eventListeners[e].indexOf(t);n>=0&&this.eventListeners[e].splice(n,1)}},fire:function(e,t){if(this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)this.eventListeners[e][n].call(this,t)}},window.Meta.ObservingProvider=function(e){if(this.addObserver(this,"eventListeners"),e)for(k in e)this[k]=e[k]},window.Meta.ObservingProvider.prototype=Object.create(window.Meta.EventsPrototype),window.Meta.ObservingProvider.prototype.addObserver=function(e,t){var n=this;if(!(e instanceof Function))if(e instanceof Array){Array.observe(e,function(e){for(var t=0;t<e.length;t++){var i=e[t];i.addedCount>0&&i.object[i.index]instanceof Object&&n.addObserver(i.object[i.index])}n.fire("changed",n)});for(var i=0;i<e.length;i++)this.addObserver(e[i])}else if(e instanceof Object){Object.observe(e,function(e){for(var t=0;t<e.length;t++){var i=e[t];"add"==i.type&&i.object[i.name]instanceof Object&&n.addObserver(i.object[i.name])}n.fire("changed",n)});for(var i in e)(t||[]).indexOf(i)<0&&this.addObserver(e[i])}},window.Meta||(window.Meta={}),window.Meta.channels={},window.Meta.Channel=function(e){this.listeners=[],this.config=e||{},this.config.name&&(window.Meta.channels[this.config.name]=this)},window.Meta.Channel.prototype.subscribe=function(e){this.listeners.push(e)},window.Meta.Channel.prototype.unsubscribe=function(e){var t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)},window.Meta.Channel.prototype.publish=function(e){this.config.onPublish&&(e=this.config.onPublish.call(this,e));for(var t=0;t<this.listeners.length;t++)this.listeners[t](e)};