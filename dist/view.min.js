/*
 * MetaJS - MetaPlatform project
 *
 * @author Jiri Hybek <jiri.hybek@cryonix.cz> / Cryonix Innovations <www.cryonix.cz>
 * @license MIT
 */
window.Meta||(window.Meta={}),window.Meta.Utils={},window.Meta.config||(window.Meta.config={}),window.Meta.config.importPrefix||(window.Meta.config.importPrefix="%module%.html"),window.Meta.Utils._importedModules=[],window.Meta.Utils["import"]=function(e,t,n){if(window.Meta.Utils._importedModules[e])return t();var i=document.createElement("link");i.rel="import",i.href=window.Meta.config.importPrefix.replace(/\%module\%/g,e),i.onload=function(){window.Meta.Utils._importedModules.push(e),t&&t()},i.onerror=function(t){console.log("Error importing meta module '"+e+"'",t),n&&n(t)},document.head.appendChild(i)},window.Meta.Utils.importMany=function(e,t,n){var i=function(e,t){window.Meta.Utils["import"](e,function(){return t()},function(){return t("Cannot import module '"+e+"'")})};window.Meta.Utils.batch(e,i,function(e){return e?n(e):t()})},window.Meta.Utils.batch=function(e,t,n){var i=-1,r=function(a){return i++,a?n(a):i==e.length?n():void t(e[i],r)};r()},window.Meta.Utils.idHashmap=function(e){for(var t={},n=e.querySelectorAll("*[id]"),i=0;i<n.length;i++)t[n.item(i).getAttribute("id")]=n.item(i);return t},window.Meta.Utils.sanitizeHtml=function(e){var t=new RegExp("<","g"),n=new RegExp("<","g");return String(e).replace(t,"&lt;").replace(n,"&gt;")},window.Meta.Utils.traverse=function(e,t){var n=t.shift();return e[n]?t.length>0?window.Meta.Utils.traverse(e[n],t):e[n]:void 0},window.Meta.Utils.formatDate=function(e,t){var n,i,r=this,a=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],o=/\\?(.?)/gi,l=function(e,t){return i[e]?i[e]():t},u=function(e,t){for(e=String(e);e.length<t;)e="0"+e;return e};return i={d:function(){return u(i.j(),2)},D:function(){return i.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return a[i.w()]+"day"},N:function(){return i.w()||7},S:function(){var e=i.j(),t=e%10;return 3>=t&&1==parseInt(e%100/10,10)&&(t=0),["st","nd","rd"][t-1]||"th"},w:function(){return n.getDay()},z:function(){var e=new Date(i.Y(),i.n()-1,i.j()),t=new Date(i.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(i.Y(),i.n()-1,i.j()-i.N()+3),t=new Date(e.getFullYear(),0,4);return u(1+Math.round((e-t)/864e5/7),2)},F:function(){return a[6+i.n()]},m:function(){return u(i.n(),2)},M:function(){return i.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(i.Y(),i.n(),0).getDate()},L:function(){var e=i.Y();return e%4===0&e%100!==0|e%400===0},o:function(){var e=i.n(),t=i.W(),n=i.Y();return n+(12===e&&9>t?1:1===e&&t>9?-1:0)},Y:function(){return n.getFullYear()},y:function(){return i.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return i.a().toUpperCase()},B:function(){var e=3600*n.getUTCHours(),t=60*n.getUTCMinutes(),i=n.getUTCSeconds();return u(Math.floor((e+t+i+3600)/86.4)%1e3,3)},g:function(){return i.G()%12||12},G:function(){return n.getHours()},h:function(){return u(i.g(),2)},H:function(){return u(i.G(),2)},i:function(){return u(n.getMinutes(),2)},s:function(){return u(n.getSeconds(),2)},u:function(){return u(1e3*n.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var e=new Date(i.Y(),0),t=Date.UTC(i.Y(),0),n=new Date(i.Y(),6),r=Date.UTC(i.Y(),6);return e-t!==n-r?1:0},O:function(){var e=n.getTimezoneOffset(),t=Math.abs(e);return(e>0?"-":"+")+u(100*Math.floor(t/60)+t%60,4)},P:function(){var e=i.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-n.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(o,l)},r:function(){return"D, d M Y H:i:s O".replace(o,l)},U:function(){return n/1e3|0}},this.date=function(e,t){return r=this,n=void 0===t?new Date:new Date(t instanceof Date?t:1e3*t),e.replace(o,l)},this.date(e,t)},window.Meta||(window.Meta={}),window.Meta.Template=function(e,t){var n=window.Meta.Template.processor(t);return function(t){n.call(e,{data:t})}},window.Meta.Template._context=function(e,t){var n={};for(var i in t)n[i]=t[i];return n.data=e.data,n},window.Meta.Template._value=function(e,t,n){if(n instanceof Function)return n.call(e,t.data,t);if("@"==n.substr(0,1))var i=t;else var i=t.data;return n.indexOf(".")>=0?window.Meta.Utils.traverse(i,n.split(".")):i[n]},window.Meta.Template.processor=function(e){for(selector in e||{})if(e[selector]instanceof Array)for(var t=0;t<e[selector].length;t++)e[selector][t]instanceof Function||(e[selector][t]=window.Meta.Template.text(e[selector][t]));else e[selector]instanceof Function||(e[selector]=window.Meta.Template.text(e[selector]));var n=function(e,t,n){if(n instanceof Array)for(var i=0;i<n.length;i++)n[i].call(e,t);else n.call(e,t)};return function(t){for(selector in e||{})if(e[selector]instanceof Function&&e[selector].runInParentContext)e[selector].call(this,window.Meta.Template._context(t,{selector:selector}));else if("@"!=selector)for(var i=this.querySelectorAll(selector),r=0;r<i.length;r++)n(i.item(r),t,e[selector]);else n(this,t,e[selector])}},window.Meta.Template.filters={},window.Meta.Template.registerFilter=function(e,t){window.Meta.Template.filters[e]=t},window.Meta.Template.html=function(e){return function(t){this.innerHTML=window.Meta.Template._value(this,t,e)||""}},window.Meta.Template.text=function(e){return function(t){this.innerHTML=window.Meta.Utils.sanitizeHtml(window.Meta.Template._value(this,t,e))}},window.Meta.Template.string=function(e){for(var t=e.match(/#\{([a-zA-Z0-9_-]*)\}/g),n={},i=0;i<t.length;i++){var r=t[i].substr(2,t[i].length-3);n[r]=new RegExp("#\\{"+r+"\\}","g")}return function(t){var i=e;for(var r in n)i=i.replace(n[r],window.Meta.Template._value(this,t,r));this.innerHTML=i}},window.Meta.Template.fn=function(e){return function(t){this.innerHTML=e.call(this,t.data,t)}},window.Meta.Template.filter=function(e,t){return function(n){if(!window.Meta.Template.filters[e])throw"Template filter '"+e+"' not registered.";this.innerHTML=window.Meta.Template.filters[e].call(this,window.Meta.Template._value(this,n,t),n)}},window.Meta.Template.date=function(e,t){return function(n){var i=window.Meta.Template._value(this,n,e);return 0/0!==parseInt(i)&&i instanceof Date?void(this.innerHTML=window.Meta.Utils.formatDate(t,i)):this.innerHTML="NaN"}},window.Meta.Template["with"]=function(e,t){var n=window.Meta.Template.processor(t);return function(t){t.data[e]&&n.call(this,window.Meta.Template._context({data:t.data[e]},{parent:t.data}))}},window.Meta.Template.attr=function(e,t){return function(n){if(this instanceof ShadowRoot)var i=this.host;else var i=this;i.setAttribute(e,window.Meta.Template._value(this,n,t))}},window.Meta.Template.attrIf=function(e,t,n){return function(i){var r=window.Meta.Template._value(this,i,t);if(this instanceof ShadowRoot)var a=this.host;else var a=this;r?a.setAttribute(e,n?"":r):a.hasAttribute(e)&&a.removeAttribute(e)}},window.Meta.Template.property=function(e,t){return function(n){if(this instanceof ShadowRoot)var i=this.host;else var i=this;i[e]=t?window.Meta.Template._value(this,n,t):n.data}},window.Meta.Template._if=function(e,t){var n=window.Meta.Template.processor(e),i=function(e){var i=t.call(this,e);if(i){if(this.__ifRegistry&&this.__ifRegistry[e.selector]){for(var r=this.__ifRegistry[e.selector],a=0;a<r.length;a++)r[a].__nextSibling&&r[a].__nextSibling.parentElement==r[a].__parent?r[a].__parent.insertBefore(r[a],r[a].__nextSibling):r[a].__parent.appendChild(r[a]);delete this.__ifRegistry[e.selector]}for(var o=this.querySelectorAll(e.selector),a=0;a<o.length;a++)n.call(o.item(a),e)}else{var o=this.querySelectorAll(e.selector);this.__ifRegistry||(this.__ifRegistry={}),this.__ifRegistry[e.selector]||(this.__ifRegistry[e.selector]=[]);for(var a=0;a<o.length;a++)o.item(a).__parent=o.item(a).parentElement,o.item(a).__nextSibling=o.item(a).nextSibling,this.__ifRegistry[e.selector].push(o.item(a)),o.item(a).parentElement.removeChild(o.item(a))}};return i.runInParentContext=!0,i},window.Meta.Template["if"]=function(e,t){return window.Meta.Template._if(t,function(t){return window.Meta.Template._value(this,t,e)?!0:!1})},window.Meta.Template.ifNot=function(e,t){return window.Meta.Template._if(t,function(t){return window.Meta.Template._value(this,t,e)?!1:!0})},window.Meta.Template.ifLt=function(e,t,n){return window.Meta.Template._if(n,function(n){return window.Meta.Template._value(this,n,e)<t?!0:!1})},window.Meta.Template.ifLte=function(e,t,n){return window.Meta.Template._if(n,function(n){return window.Meta.Template._value(this,n,e)<=t?!0:!1})},window.Meta.Template.ifGt=function(e,t,n){return window.Meta.Template._if(n,function(n){return window.Meta.Template._value(this,n,e)>t?!0:!1})},window.Meta.Template.ifGte=function(e,t,n){return window.Meta.Template._if(n,function(n){return window.Meta.Template._value(this,n,e)>=t?!0:!1})},window.Meta.Template.repeat=function(e,t){var n=window.Meta.Template.processor(t),i=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)t[n]=e[n];else{if(!(e instanceof Object))return null;var i=0;for(var n in e||{})t[i]=n,i++}return t},r=function(t){if(this.__repeatTemplate||(this.__repeatTemplate={}),!this.__repeatTemplate[t.selector]){this.__repeatTemplate[t.selector]=[];for(var r=this.querySelectorAll(t.selector),a=0;a<r.length;a++)r.item(a).__parent=r.item(a).parentElement,this.__repeatTemplate[t.selector].push(r.item(a)),r.item(a).parentElement.removeChild(r.item(a))}var o=this,l=[],u={},w=null,s=window.Meta.Template._value(this,t,e),f=i(s);if(f){for(var r=this.querySelectorAll(t.selector),a=0;a<r.length;a++){var d=f.indexOf(r.item(a).__id);d>=0?(u[d]||(u[d]=[]),u[d].push(r.item(a))):l.push(r.item(a))}for(var c=0;c<l.length;c++)l[c].parentElement.removeChild(l[c]);delete l;for(var a=0;a<f.length;a++){if(f[a]instanceof Object)var p=f[a];else var p=s[f[a]];if(u[a])for(var m=0;m<u[a].length;m++)u[a][m]instanceof HTMLElement&&n.call(u[a][m],window.Meta.Template._context({data:p},{parent:t.data,key:a})),u[a][m].previousElementSibling!=w&&u[a][m].parentElement.appendChild(u[a][m]),w=u[a][m];else for(var h=0;h<o.__repeatTemplate[t.selector].length;h++){var _=o.__repeatTemplate[t.selector][h].cloneNode(!0);_.__id=f[a],o.__repeatTemplate[t.selector][h].__parent.appendChild(_),n.call(_,window.Meta.Template._context({data:p},{parent:t.data,key:a})),w=_}}}};return r.runInParentContext=!0,r},window.$__html=window.Meta.Template.html,window.$__text=window.Meta.Template.text,window.$__string=window.Meta.Template.string,window.$__fn=window.Meta.Template.fn,window.$__filter=window.Meta.Template.filter,window.$__date=window.Meta.Template.date,window.$__attr=window.Meta.Template.attr,window.$__attrIf=window.Meta.Template.attrIf,window.$__prop=window.Meta.Template.property,window.$__if=window.Meta.Template["if"],window.$__ifNot=window.Meta.Template.ifNot,window.$__ifLt=window.Meta.Template.ifLt,window.$__ifLte=window.Meta.Template.ifLte,window.$__ifGt=window.Meta.Template.ifGt,window.$__ifGte=window.Meta.Template.ifGte,window.$__repeat=window.Meta.Template.repeat,window.$__with=window.Meta.Template["with"],window.Meta||(window.Meta={}),window.Meta.views={},window.Meta.ViewPrototype=Object.create(HTMLTemplateElement.prototype),window.Meta.ViewPrototype.createdCallback=function(){this.hasAttribute("name")&&(window.Meta.views[this.getAttribute("name")]=this)},window.Meta.ViewPrototype.instance=function(e,t){var n=this,i={target:null,template:null,model:{},events:{},eventsContext:null,configure:function(e,t){i.target=e,i.target._templateInstanced||(i.target.innerHTML="",i.target.appendChild(document.importNode(n.content,!0)),i.target._templateInstanced=!0),i.template=window.Meta.Template(e,t)},on:function(e,t,n){i.events[e+" "+t]=n},_bindEvents:function(){var e=function(e,t,n){if(!(e._boundEvents&&e._boundEvents.indexOf(t)>=0)){var r=function(t){t.sender=e,n.call(i.eventsContext||this,t)};r.eventName=t,e.addEventListener(t,r),e._boundEvents||(e._boundEvents=[]),e._boundEventHandlers||(e._boundEventHandlers=[]),e._boundEvents.push(t),e._boundEventHandlers.push(r)}};for(var t in i.events){var n=t.split(" "),r=n.shift(),a=n.join(" ");if(""!=a)var o=i.target.querySelectorAll(a);else if(i.target instanceof ShadowRoot)var o=[i.target.host];else var o=[i.target];for(var l=0;l<o.length;l++)e(o[l],r,i.events[t])}},_unbindEvents:function(){for(var e in i.events){var t=e.split(" "),n=(t.shift(),t.join(" "));if(""!=n)var r=i.target.querySelectorAll(n);else if(i.target instanceof ShadowRoot)var r=[i.target.host];else var r=[i.target];for(var a=0;a<r.length;a++)if(r[a]._boundEventHandlers){for(var e=0;e<r[a]._boundEventHandlers.length;e++)r[a].removeEventListener(r[a]._boundEventHandlers[e].eventName,r[a]._boundEventHandlers[e]);r[a]._boundEvents=[],r[a]._boundEventHandlers=[]}}},render:function(){if(!i.template)throw"Template is not configured.";i.template(i.model),i._bindEvents(),i.$=window.Meta.Utils.idHashmap(i.target)},find:function(e){return i.target.querySelector(e)},findAll:function(e){return i.target.querySelectorAll(e)}};return i.eventsContext=i,e&&t&&i.configure(e,t),i},document.registerElement("meta-view",{prototype:window.Meta.ViewPrototype,"extends":"template"});